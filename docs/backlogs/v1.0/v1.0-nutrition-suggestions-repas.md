# üìù Plan de D√©veloppement - Feature Suggestions Repas/Snacks (MVP v1.0)

## üéØ Vue d'ensemble

### Description de la Feature
Syst√®me intelligent de suggestions de repas et snacks adapt√©s aux sympt√¥mes SOPK et √† la phase du cycle, avec focus sur l'index glyc√©mique bas et la simplicit√© de pr√©paration.

### Valeur Utilisateur
- **Aide imm√©diate** : Savoir quoi manger selon ses sympt√¥mes du moment
- **√âducation douce** : Apprendre les bons r√©flexes alimentaires sans dogmatisme
- **Simplicit√©** : Suggestions courtes et faciles √† pr√©parer au quotidien

### Score RICE
- **Reach** : 5/5 (100% des utilisatrices SOPK ont des questions nutrition)
- **Impact** : 5/5 (alimentation = pilier central de gestion SOPK)
- **Confidence** : 4/5 (feature complexe mais bien d√©finie)
- **Effort** : 2/5 (logique m√©tier + base de donn√©es repas)
- **Score Final** : **50** ‚úÖ **Priorit√© #3**

---

## üîÑ Diagrammes de Flux

### User Journey - Obtenir une Suggestion

```mermaid
flowchart TD
    A[Utilisatrice cherche quoi manger] --> B{Point d'entr√©e?}

    B -->|Dashboard| C[Suggestion du moment affich√©e]
    B -->|Notification| D[Push "Id√©e repas pour ton √©nergie"]
    B -->|Module nutrition| E[Page suggestions compl√®te]

    C --> F[Contexte automatique]
    D --> F
    E --> F

    F --> G[Analyse du profil]
    G --> H[Sympt√¥mes du jour]
    G --> I[Phase du cycle]
    G --> J[Pr√©f√©rences utilisateur]
    G --> K[Historique alimentaire]

    H --> L[Moteur de suggestions]
    I --> L
    J --> L
    K --> L

    L --> M[S√©lection de 2-3 options]
    M --> N[Affichage suggestions]

    N --> O[Utilisatrice choisit]
    O --> P{Action choisie?}

    P -->|Voir recette| Q[Redirection recettes d√©taill√©es]
    P -->|Ajouter au journal| R[Track consommation]
    P -->|Autres suggestions| S[Rafra√Æchir suggestions]
    P -->|Personnaliser| T[Ajuster pr√©f√©rences]

    R --> U[Mise √† jour dashboard nutrition]
    Q --> V[Module recettes]

    style A fill:#ffcdd2
    style L fill:#e1f5fe
    style N fill:#e8f5e8
```

### Architecture Technique

```mermaid
graph TB
    subgraph "Module Nutrition - src/modules/nutrition/"
        A[MealSuggestionsView.jsx] --> B[SuggestionEngine.jsx]
        B --> C[SuggestionCard.jsx]
        B --> D[SuggestionFilters.jsx]
        B --> E[MealTypeSelector.jsx]

        B --> F[useMealSuggestions Hook]
        F --> G[suggestionLogic.js]
        F --> H[nutritionService.js]
        F --> I[mealDatabase.js]
    end

    subgraph "Integration Modules"
        J[Dashboard] --> B
        K[Journal Cycle] --> F
        L[Stress Module] --> F
    end

    subgraph "Shared Components - src/shared/"
        M[TagSelector.jsx]
        N[DifficultyIndicator.jsx]
        O[NutritionTag.jsx]
        P[useUserPreferences Hook]
    end

    subgraph "Database - Supabase"
        H --> Q[(meals_suggestions)]
        H --> R[(user_meal_tracking)]
        H --> S[(user_preferences)]
    end

    C --> M
    C --> N
    C --> O
    F --> P

    style A fill:#e3f2fd
    style H fill:#c8e6c9
    style Q fill:#ffcdd2
    style M fill:#fff3e0
```

### Flux de Donn√©es

```mermaid
sequenceDiagram
    participant U as Utilisatrice
    participant D as Dashboard
    participant S as Suggestion Engine
    participant DB as Database
    participant P as Profiler

    U->>D: Consulte dashboard
    D->>P: getUserContext()
    P->>DB: R√©cup√®re sympt√¥mes + cycle + pr√©fs
    DB-->>P: Donn√©es utilisateur
    P-->>S: Context enrichi

    S->>S: Analyse besoins nutritionnels
    S->>DB: Recherche repas adapt√©s
    DB-->>S: Suggestions candidates

    S->>S: Filtre et score suggestions
    S-->>D: Top 3 suggestions
    D-->>U: Affiche "Id√©e repas pour ta fatigue"

    U->>D: Clique suggestion
    D->>S: getMealDetails(mealId)
    S->>DB: R√©cup√®re recette compl√®te
    DB-->>S: D√©tails repas
    S-->>D: Recette + infos nutrition
    D-->>U: Vue d√©taill√©e

    U->>D: "J'ai mang√© √ßa"
    D->>DB: Track consumption
    Note over DB: Am√©liore suggestions futures
```

---

## üèóÔ∏è Architecture Technique

### Structure des Donn√©es

```sql
-- Base de donn√©es des repas et suggestions
CREATE TABLE meal_suggestions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- Informations de base
  name VARCHAR(100) NOT NULL,
  category VARCHAR(50) NOT NULL, -- 'breakfast', 'lunch', 'dinner', 'snack'
  difficulty VARCHAR(20) NOT NULL, -- 'very_easy', 'easy', 'medium'
  prep_time_minutes INTEGER NOT NULL,

  -- Nutrition
  glycemic_index_category VARCHAR(20), -- 'low', 'medium', 'high'
  main_nutrients TEXT[], -- ['protein', 'fiber', 'omega3']
  estimated_calories INTEGER,

  -- SOPK-specific
  sopk_benefits TEXT[], -- ['insulin_regulation', 'inflammation_reduction']
  symptom_targets TEXT[], -- ['fatigue', 'cravings', 'period_pain']
  cycle_phases TEXT[], -- ['menstrual', 'follicular', 'ovulation', 'luteal']

  -- Contenu
  ingredients_simple TEXT NOT NULL, -- Version ultra-courte
  preparation_steps TEXT NOT NULL, -- Instructions courtes
  tips TEXT, -- Conseils optionnels

  -- M√©tadonn√©es
  season TEXT[], -- ['spring', 'summer', 'autumn', 'winter']
  dietary_restrictions TEXT[], -- ['vegetarian', 'vegan', 'gluten_free']
  mood_boosting BOOLEAN DEFAULT false,

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tracking des repas consomm√©s par utilisateur
CREATE TABLE user_meal_tracking (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  meal_id UUID REFERENCES meal_suggestions(id),

  date DATE NOT NULL,
  meal_type VARCHAR(20) NOT NULL, -- 'breakfast', 'lunch', 'dinner', 'snack'

  -- Feedback utilisateur
  satisfaction_rating INTEGER CHECK (satisfaction_rating >= 1 AND satisfaction_rating <= 5),
  difficulty_felt VARCHAR(20), -- 'easier', 'as_expected', 'harder'
  will_remake BOOLEAN,

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Pr√©f√©rences alimentaires utilisateur
CREATE TABLE user_nutrition_preferences (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,

  -- Contraintes alimentaires
  dietary_restrictions TEXT[], -- ['vegetarian', 'gluten_free', 'dairy_free']

  -- Pr√©f√©rences
  preferred_meal_complexity VARCHAR(20) DEFAULT 'easy', -- 'very_easy', 'easy', 'medium'
  max_prep_time_minutes INTEGER DEFAULT 30,

  -- Dislikes/Allergies
  disliked_ingredients TEXT[],
  allergies TEXT[],

  -- Objectifs
  primary_nutrition_goals TEXT[], -- ['weight_management', 'energy_boost', 'inflammation_reduction']

  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),

  UNIQUE(user_id)
);
```

### Structure Modulaire

#### Module Nutrition (`src/modules/nutrition/`)
```
src/modules/nutrition/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ suggestions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SuggestionCard.jsx         # Carte suggestion individuelle
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SuggestionsList.jsx        # Liste des suggestions
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SuggestionFilters.jsx      # Filtres (temps, difficult√©)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MealTypeSelector.jsx       # S√©lecteur type repas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ QuickActionButtons.jsx     # Actions rapides (j'ai mang√©, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ tracking/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MealTracker.jsx            # Interface tracking repas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FeedbackForm.jsx           # Feedback post-consommation
‚îÇ   ‚îî‚îÄ‚îÄ preferences/
‚îÇ       ‚îú‚îÄ‚îÄ DietaryPreferences.jsx     # Pr√©f√©rences alimentaires
‚îÇ       ‚îî‚îÄ‚îÄ NutritionGoals.jsx         # Objectifs nutrition
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useMealSuggestions.js          # Hook principal suggestions
‚îÇ   ‚îú‚îÄ‚îÄ useMealTracking.js             # Hook tracking repas
‚îÇ   ‚îú‚îÄ‚îÄ useNutritionPreferences.js     # Hook gestion pr√©f√©rences
‚îÇ   ‚îî‚îÄ‚îÄ useMealDatabase.js             # Hook acc√®s base repas
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ nutritionService.js            # API calls nutrition
‚îÇ   ‚îú‚îÄ‚îÄ suggestionService.js           # Logique de suggestions
‚îÇ   ‚îî‚îÄ‚îÄ trackingService.js             # Service de tracking
‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îî‚îÄ‚îÄ nutrition.types.js             # Types nutrition et repas
‚îú‚îÄ‚îÄ views/
‚îÇ   ‚îú‚îÄ‚îÄ MealSuggestionsView.jsx        # Point d'entr√©e suggestions
‚îÇ   ‚îî‚îÄ‚îÄ NutritionPreferencesView.jsx   # Gestion pr√©f√©rences
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ suggestionLogic.js             # Algorithme de suggestions
‚îÇ   ‚îú‚îÄ‚îÄ mealDatabase.js                # Base de donn√©es repas statique
‚îÇ   ‚îú‚îÄ‚îÄ nutritionHelpers.js            # Helpers calculs nutrition
‚îÇ   ‚îî‚îÄ‚îÄ nutritionValidation.js         # Validation Zod
‚îî‚îÄ‚îÄ data/
    ‚îú‚îÄ‚îÄ meals.json                     # Base de donn√©es repas (MVP)
    ‚îî‚îÄ‚îÄ nutritionConstants.js          # Constantes nutrition
```

#### Extension Composants Partag√©s (`src/shared/`)
```
src/shared/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NutritionTag.jsx           # Tags nutrition (IG bas, prot√©ines)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DifficultyIndicator.jsx    # Indicateur difficult√©
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrepTimeIndicator.jsx      # Indicateur temps de pr√©paration
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RatingStars.jsx            # Syst√®me de notation
‚îÇ   ‚îî‚îÄ‚îÄ nutrition/
‚îÇ       ‚îú‚îÄ‚îÄ IngredientsList.jsx        # Liste ingr√©dients format√©e
‚îÇ       ‚îî‚îÄ‚îÄ NutritionBadges.jsx        # Badges b√©n√©fices SOPK
‚îú‚îÄ‚îÄ hooks/
‚îÇ   ‚îú‚îÄ‚îÄ useUserPreferences.js          # Hook pr√©f√©rences g√©n√©rales
‚îÇ   ‚îî‚îÄ‚îÄ useContextualSuggestions.js    # Hook suggestions contextuelles
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ nutritionScoring.js            # Algorithmes de scoring
    ‚îî‚îÄ‚îÄ mealFiltering.js               # Logique de filtrage repas
```

### Services API

```javascript
// src/modules/nutrition/services/suggestionService.js
export const suggestionService = {
  // Obtenir suggestions personnalis√©es
  async getPersonalizedSuggestions(userId, context = {}) {
    const {
      mealType = 'any',
      symptoms = [],
      cyclePhase = null,
      timeOfDay = new Date().getHours(),
      maxPrepTime = 30
    } = context;

    // R√©cup√©rer pr√©f√©rences utilisateur
    const { data: preferences } = await nutritionService.getUserPreferences(userId);

    // R√©cup√©rer historique r√©cent
    const { data: recentMeals } = await trackingService.getRecentMeals(userId, 7);

    // Utiliser l'algorithme de suggestion
    const suggestions = SuggestionEngine.generateSuggestions({
      symptoms,
      cyclePhase,
      timeOfDay,
      maxPrepTime,
      preferences,
      recentMeals,
      mealType
    });

    return { data: suggestions };
  },

  // Rechercher repas par crit√®res
  async searchMeals(filters = {}) {
    // Logique de recherche dans la base repas
    const filteredMeals = MealDatabase.search(filters);
    return { data: filteredMeals };
  },

  // Obtenir d√©tails d'un repas
  async getMealDetails(mealId) {
    const meal = MealDatabase.getById(mealId);
    return { data: meal };
  }
};

// src/modules/nutrition/services/trackingService.js
export const trackingService = {
  // Enregistrer un repas consomm√©
  async trackMealConsumption(userId, mealId, mealType, feedback = {}) {
    const { error } = await supabase
      .from('user_meal_tracking')
      .insert({
        user_id: userId,
        meal_id: mealId,
        meal_type: mealType,
        date: new Date().toISOString().split('T')[0],
        ...feedback
      });
    return { error };
  },

  // R√©cup√©rer repas r√©cents
  async getRecentMeals(userId, days = 7) {
    const startDate = new Date(Date.now() - days * 24 * 60 * 60 * 1000);
    const { data, error } = await supabase
      .from('user_meal_tracking')
      .select(`
        *,
        meal_suggestions(name, category, main_nutrients)
      `)
      .eq('user_id', userId)
      .gte('created_at', startDate.toISOString())
      .order('created_at', { ascending: false });
    return { data, error };
  }
};
```

---

## üé® Design UX/UI

### Interface Mobile-First

#### Int√©gration Dashboard
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      üè† Dashboard       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                         ‚îÇ
‚îÇ  üçΩÔ∏è Id√©e repas pour toi ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  üò¥ Tu sembles fatigu√©e ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  ü•ó Salade quinoa-avocat ‚îÇ
‚îÇ  ‚è±Ô∏è 15 min ‚Ä¢ üü¢ IG bas   ‚îÇ
‚îÇ  üí™ Prot√©ines ‚Ä¢ ‚ö° √ânergie‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  [Voir recette] [Autres]‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  ‚ùì Pas d'id√©e pour le   ‚îÇ
‚îÇ     go√ªter ? D√©couvre   ‚îÇ
‚îÇ     nos suggestions ‚Üí   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### Page Suggestions Compl√®te
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   üçΩÔ∏è Suggestions repas   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                         ‚îÇ
‚îÇ  Pour quand ?           ‚îÇ
‚îÇ  [Maintenant] [+ tard]  ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  Type de repas          ‚îÇ
‚îÇ  üåÖ P.d√©j  üçΩÔ∏è Repas     ‚îÇ
‚îÇ  ü•® Snack  üåô D√Æner    ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  ‚è±Ô∏è Temps: [15 min ‚ñº]   ‚îÇ
‚îÇ  üçΩÔ∏è Difficult√©: [Facile‚ñº]‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  üìã Suggestions pour toi:‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ü•ó Bowl √©nergie     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚è±Ô∏è 10 min ‚Ä¢ üü¢ IG bas‚îÇ ‚îÇ
‚îÇ  ‚îÇ üí™ Parfait contre   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ    la fatigue       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [Voir] [‚úÖ Mang√©]   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ ü•™ Tartine avocat   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ ‚è±Ô∏è 5 min ‚Ä¢ üü¢ IG bas ‚îÇ ‚îÇ
‚îÇ  ‚îÇ üßò Anti-stress      ‚îÇ ‚îÇ
‚îÇ  ‚îÇ [Voir] [‚úÖ Mang√©]   ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### D√©tail d'une Suggestion
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ü•ó Bowl √ânergie SOPK   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                         ‚îÇ
‚îÇ  ‚è±Ô∏è 10 min de pr√©paration‚îÇ
‚îÇ  üü¢ Index glyc√©mique bas ‚îÇ
‚îÇ  üí™ Riche en prot√©ines   ‚îÇ
‚îÇ  ‚ö° Booste l'√©nergie     ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  üõí Ingr√©dients :       ‚îÇ
‚îÇ  ‚Ä¢ Quinoa cuit (150g)   ‚îÇ
‚îÇ  ‚Ä¢ Avocat (1/2)         ‚îÇ
‚îÇ  ‚Ä¢ ≈íuf dur (1)          ‚îÇ
‚îÇ  ‚Ä¢ √âpinards (poign√©e)   ‚îÇ
‚îÇ  ‚Ä¢ Graines tournesol    ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  üë©‚Äçüç≥ Pr√©paration :        ‚îÇ
‚îÇ  1. M√©lange quinoa +    ‚îÇ
‚îÇ     √©pinards dans bol   ‚îÇ
‚îÇ  2. Ajoute avocat en    ‚îÇ
‚îÇ     lamelles           ‚îÇ
‚îÇ  3. ≈íuf dur coup√© +    ‚îÇ
‚îÇ     graines par-dessus ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  üí° Parfait quand tu as ‚îÇ
‚îÇ     besoin d'√©nergie    ‚îÇ
‚îÇ     stable !           ‚îÇ
‚îÇ                         ‚îÇ
‚îÇ  [‚úÖ J'ai mang√© √ßa]     ‚îÇ
‚îÇ  [üì± Partager]          ‚îÇ
‚îÇ  [‚≠ê Noter cette recette]‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Design System - Nutrition

```css
:root {
  /* Couleurs par typologie nutritionnelle */
  --nutrition-protein: #8BC34A;     /* Vert - prot√©ines */
  --nutrition-fiber: #FF9800;       /* Orange - fibres */
  --nutrition-omega3: #2196F3;      /* Bleu - om√©ga 3 */
  --nutrition-low-gi: #4CAF50;      /* Vert fonc√© - IG bas */

  /* Difficult√©s */
  --difficulty-easy: #4CAF50;       /* Vert - facile */
  --difficulty-medium: #FF9800;     /* Orange - moyen */
  --difficulty-hard: #F44336;       /* Rouge - difficile */

  /* Temps de pr√©paration */
  --time-quick: #4CAF50;            /* < 15 min */
  --time-medium: #FF9800;           /* 15-30 min */
  --time-long: #F44336;             /* > 30 min */
}

.suggestion-card {
  border-radius: 12px;
  border: 2px solid #F5F5F5;
  transition: all 0.3s ease;
}

.suggestion-card:hover {
  border-color: var(--nutrition-low-gi);
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.15);
}

.nutrition-tag {
  font-size: 0.75rem;
  padding: 0.25rem 0.5rem;
  border-radius: 16px;
  font-weight: 500;
}

.nutrition-tag.protein {
  background: #E8F5E8;
  color: var(--nutrition-protein);
}

.difficulty-indicator.easy::before {
  content: "üü¢";
}

.prep-time-indicator.quick::before {
  content: "‚ö°";
  color: var(--time-quick);
}
```

---

## üì± User Stories D√©taill√©es

### US1: Suggestion Contextuelle
**En tant qu'** utilisatrice SOPK fatigu√©e
**Je veux** des id√©es de repas qui donnent de l'√©nergie
**Afin de** savoir quoi manger sans r√©fl√©chir

**Crit√®res d'acceptation** :
- [ ] Suggestion adapt√©e automatiquement √† mes sympt√¥mes du jour
- [ ] Propositions concr√®tes avec temps de pr√©paration r√©aliste
- [ ] Explication simple des b√©n√©fices pour le SOPK
- [ ] Maximum 3 suggestions pour √©viter l'ind√©cision
- [ ] Acc√®s depuis dashboard en 1 clic

### US2: Repas Faciles et Rapides
**En tant qu'** utilisatrice d√©bord√©e
**Je veux** des repas simples en moins de 15 minutes
**Afin de** bien manger m√™me quand j'ai peu de temps

**Crit√®res d'acceptation** :
- [ ] Filtrage par temps de pr√©paration (5, 15, 30 min)
- [ ] Niveau de difficult√© clairement indiqu√©
- [ ] Ingr√©dients faciles √† trouver en supermarch√©
- [ ] Instructions en 3-4 √©tapes maximum
- [ ] Option "Tr√®s facile" pour les jours difficiles

### US3: Apprentissage Sans Culpabilit√©
**En tant qu'** utilisatrice qui n'a pas de bases en nutrition
**Je veux** comprendre pourquoi tel repas est bon pour moi
**Afin d'** apprendre progressivement sans me sentir jug√©e

**Crit√®res d'acceptation** :
- [ ] Explications courtes et bienveillantes des bienfaits
- [ ] Pas de jargon m√©dical ou de restrictions strictes
- [ ] Focus sur les b√©n√©fices positifs (√©nergie, bien-√™tre)
- [ ] Suggestions alternatives sans frustration
- [ ] Langage inclusif et non culpabilisant

---

## üõ†Ô∏è Impl√©mentation D√©taill√©e

### Sprint 1: Base de Donn√©es Repas (Semaine 1)
**Objectif** : Cr√©er la foundation avec premi√®re base de repas

**T√¢ches** :
1. **Structure base de donn√©es**
   ```sql
   -- Cr√©ation tables compl√®tes
   -- Insertion 30-50 repas de base pour MVP

   INSERT INTO meal_suggestions (name, category, difficulty, prep_time_minutes, ...) VALUES
   ('Bowl quinoa-avocat', 'lunch', 'easy', 10, 'low',
    ARRAY['protein', 'fiber'], 350, ARRAY['insulin_regulation'],
    ARRAY['fatigue'], ARRAY['any'],
    'Quinoa cuit, avocat, ≈ìuf dur, √©pinards, graines',
    '1. M√©langer quinoa + √©pinards 2. Ajouter avocat en lamelles 3. ≈íuf et graines par-dessus',
    'Id√©al pour √©nergie stable !'),
   (...);
   ```

2. **Base de donn√©es statique pour MVP**
   ```javascript
   // src/modules/nutrition/data/meals.json
   export const mealsDatabase = [
     {
       id: 'bowl-quinoa-avocat',
       name: 'Bowl Quinoa-Avocat',
       category: 'lunch',
       difficulty: 'easy',
       prepTimeMinutes: 10,
       glycemicIndex: 'low',
       mainNutrients: ['protein', 'fiber', 'healthy_fats'],
       sopkBenefits: ['insulin_regulation', 'sustained_energy'],
       symptomTargets: ['fatigue', 'cravings'],
       cyclePhases: ['any'],
       ingredients: 'Quinoa cuit (150g), avocat (1/2), ≈ìuf dur (1), √©pinards (poign√©e), graines de tournesol',
       preparation: '1. M√©langer quinoa + √©pinards dans un bol\n2. Ajouter avocat en lamelles\n3. ≈íuf dur coup√© + graines par-dessus',
       tips: 'Id√©al quand tu as besoin d\'√©nergie stable !',
       estimatedCalories: 350,
       season: ['spring', 'summer', 'autumn', 'winter'],
       dietaryRestrictions: ['vegetarian'],
       moodBoosting: true
     },
     // ... autres repas
   ];
   ```

3. **Service de base**
   ```javascript
   // src/modules/nutrition/utils/mealDatabase.js
   import { mealsDatabase } from '../data/meals.json';

   export class MealDatabase {
     static search(filters = {}) {
       let results = mealsDatabase;

       if (filters.category) {
         results = results.filter(meal => meal.category === filters.category);
       }

       if (filters.maxPrepTime) {
         results = results.filter(meal => meal.prepTimeMinutes <= filters.maxPrepTime);
       }

       if (filters.difficulty) {
         results = results.filter(meal => meal.difficulty === filters.difficulty);
       }

       if (filters.symptomTargets?.length) {
         results = results.filter(meal =>
           filters.symptomTargets.some(symptom =>
             meal.symptomTargets.includes(symptom)
           )
         );
       }

       return results;
     }

     static getById(id) {
       return mealsDatabase.find(meal => meal.id === id);
     }

     static getByCategory(category) {
       return mealsDatabase.filter(meal => meal.category === category);
     }

     static getForSymptoms(symptoms = []) {
       return mealsDatabase.filter(meal =>
         symptoms.some(symptom => meal.symptomTargets.includes(symptom))
       );
     }
   }
   ```

### Sprint 2: Algorithme de Suggestions (Semaine 2)
**Objectif** : Logique m√©tier intelligente de recommandations

**T√¢ches** :
1. **Moteur de suggestions**
   ```javascript
   // src/modules/nutrition/utils/suggestionLogic.js
   export class SuggestionEngine {
     static generateSuggestions(context) {
       const {
         symptoms = [],
         cyclePhase = null,
         timeOfDay = 12,
         maxPrepTime = 30,
         preferences = {},
         recentMeals = [],
         mealType = 'any'
       } = context;

       // 1. Filtrer par contraintes de base
       let candidates = MealDatabase.search({
         category: mealType !== 'any' ? mealType : this.detectMealType(timeOfDay),
         maxPrepTime: Math.min(maxPrepTime, preferences.maxPrepTime || 30),
         difficulty: preferences.preferredComplexity || 'easy'
       });

       // 2. Exclure r√©gimes alimentaires non compatibles
       if (preferences.dietaryRestrictions?.length) {
         candidates = candidates.filter(meal =>
           preferences.dietaryRestrictions.every(restriction =>
             meal.dietaryRestrictions?.includes(restriction) ||
             !this.conflictsWith(meal, restriction)
           )
         );
       }

       // 3. Exclure ingr√©dients d√©test√©s/allergies
       if (preferences.dislikedIngredients?.length || preferences.allergies?.length) {
         const forbidden = [...(preferences.dislikedIngredients || []), ...(preferences.allergies || [])];
         candidates = candidates.filter(meal =>
           !forbidden.some(ingredient =>
             meal.ingredients.toLowerCase().includes(ingredient.toLowerCase())
           )
         );
       }

       // 4. Scorer selon pertinence contexte SOPK
       const scoredCandidates = candidates.map(meal => ({
         ...meal,
         score: this.calculateMealScore(meal, { symptoms, cyclePhase, recentMeals })
       }));

       // 5. Trier et retourner top 3
       return scoredCandidates
         .sort((a, b) => b.score - a.score)
         .slice(0, 3);
     }

     static calculateMealScore(meal, context) {
       let score = 50; // Score de base

       // Bonus pour sympt√¥mes cibl√©s
       if (context.symptoms?.length) {
         const symptomMatch = context.symptoms.filter(symptom =>
           meal.symptomTargets.includes(symptom)
         ).length;
         score += symptomMatch * 20;
       }

       // Bonus pour phase de cycle
       if (context.cyclePhase && meal.cyclePhases.includes(context.cyclePhase)) {
         score += 15;
       }

       // Malus pour r√©p√©tition r√©cente
       const recentCount = context.recentMeals?.filter(rm => rm.meal_id === meal.id).length || 0;
       score -= recentCount * 10;

       // Bonus pour index glyc√©mique bas (priorit√© SOPK)
       if (meal.glycemicIndex === 'low') {
         score += 10;
       }

       // Bonus pour boost humeur si besoin
       if (meal.moodBoosting && context.symptoms?.includes('mood_low')) {
         score += 15;
       }

       return Math.max(0, score);
     }

     static detectMealType(hour) {
       if (hour < 10) return 'breakfast';
       if (hour < 14) return 'lunch';
       if (hour < 17) return 'snack';
       return 'dinner';
     }

     static conflictsWith(meal, restriction) {
       const conflicts = {
         'vegetarian': ['meat', 'fish', 'chicken'],
         'vegan': ['meat', 'fish', 'chicken', 'egg', 'dairy', 'cheese'],
         'gluten_free': ['wheat', 'bread', 'pasta']
       };

       const conflictWords = conflicts[restriction] || [];
       return conflictWords.some(word =>
         meal.ingredients.toLowerCase().includes(word)
       );
     }
   }
   ```

2. **Hook principal**
   ```javascript
   // src/modules/nutrition/hooks/useMealSuggestions.js
   import { useState, useEffect } from 'react';
   import { SuggestionEngine } from '../utils/suggestionLogic';
   import { useUserPreferences } from '../../../shared/hooks/useUserPreferences';

   export const useMealSuggestions = (context = {}) => {
     const [suggestions, setSuggestions] = useState([]);
     const [loading, setLoading] = useState(false);
     const [error, setError] = useState(null);

     const { preferences } = useUserPreferences();

     const generateSuggestions = async (customContext = {}) => {
       setLoading(true);
       setError(null);

       try {
         // Enrichir le contexte avec donn√©es utilisateur
         const enrichedContext = {
           ...context,
           ...customContext,
           preferences: preferences?.nutrition || {}
         };

         // R√©cup√©rer historique r√©cent
         if (enrichedContext.userId) {
           const { data: recentMeals } = await trackingService.getRecentMeals(
             enrichedContext.userId,
             7
           );
           enrichedContext.recentMeals = recentMeals || [];
         }

         // G√©n√©rer suggestions
         const newSuggestions = SuggestionEngine.generateSuggestions(enrichedContext);
         setSuggestions(newSuggestions);
       } catch (err) {
         setError(err);
         console.error('Erreur g√©n√©ration suggestions:', err);
       } finally {
         setLoading(false);
       }
     };

     const refreshSuggestions = () => generateSuggestions();

     const trackMealChosen = async (mealId, mealType) => {
       if (context.userId) {
         await trackingService.trackMealConsumption(
           context.userId,
           mealId,
           mealType
         );
         // Reg√©n√©rer suggestions pour prendre en compte le nouveau choix
         generateSuggestions();
       }
     };

     useEffect(() => {
       generateSuggestions();
     }, [context.symptoms, context.cyclePhase, preferences]);

     return {
       suggestions,
       loading,
       error,
       refreshSuggestions,
       trackMealChosen
     };
   };
   ```

### Sprint 3: Interface Utilisateur (Semaine 3)
**Objectif** : UX/UI compl√®te et int√©gration dashboard

**T√¢ches** :
1. **Composant SuggestionCard**
   ```jsx
   // src/modules/nutrition/components/suggestions/SuggestionCard.jsx
   import { DifficultyIndicator } from '../../../../shared/components/ui/DifficultyIndicator';
   import { PrepTimeIndicator } from '../../../../shared/components/ui/PrepTimeIndicator';
   import { NutritionTag } from '../../../../shared/components/ui/NutritionTag';

   export const SuggestionCard = ({ meal, onViewDetails, onTrackMeal }) => {
     const handleTrackMeal = () => {
       onTrackMeal(meal.id, meal.category);
       // Feedback visuel
       toast.success('Super ! Repas ajout√© √† ton suivi üçΩÔ∏è');
     };

     return (
       <div className="suggestion-card bg-white p-4 rounded-xl border-2 border-gray-100 hover:border-green-400 transition-all">
         <div className="flex justify-between items-start mb-3">
           <h3 className="font-semibold text-lg text-gray-800">
             {meal.name}
           </h3>
           <button
             onClick={() => onViewDetails(meal)}
             className="text-blue-500 text-sm"
           >
             Voir ‚Üí
           </button>
         </div>

         <div className="flex gap-2 mb-3">
           <PrepTimeIndicator minutes={meal.prepTimeMinutes} />
           <DifficultyIndicator level={meal.difficulty} />
           {meal.glycemicIndex === 'low' && (
             <NutritionTag type="low-gi">üü¢ IG bas</NutritionTag>
           )}
         </div>

         <div className="flex gap-1 mb-3 flex-wrap">
           {meal.mainNutrients.slice(0, 2).map(nutrient => (
             <NutritionTag key={nutrient} type={nutrient}>
               {this.getNutrientLabel(nutrient)}
             </NutritionTag>
           ))}
         </div>

         {meal.tips && (
           <p className="text-sm text-gray-600 italic mb-3">
             üí° {meal.tips}
           </p>
         )}

         <div className="flex gap-2">
           <button
             onClick={() => onViewDetails(meal)}
             className="flex-1 bg-blue-50 text-blue-600 py-2 px-4 rounded-lg text-sm font-medium hover:bg-blue-100"
           >
             Voir recette
           </button>
           <button
             onClick={handleTrackMeal}
             className="bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-600"
           >
             ‚úÖ Mang√©
           </button>
         </div>
       </div>
     );
   };
   ```

2. **Int√©gration Dashboard**
   ```jsx
   // Extension du Dashboard principal pour inclure suggestions
   import { useMealSuggestions } from '../../modules/nutrition/hooks/useMealSuggestions';

   export const DashboardView = () => {
     const { currentSymptoms, cyclePhase } = useDailySymptoms();
     const { suggestions } = useMealSuggestions({
       symptoms: currentSymptoms,
       cyclePhase,
       mealType: 'auto', // D√©tection automatique selon heure
       userId: user.id
     });

     const primarySuggestion = suggestions[0];

     return (
       <div className="dashboard">
         {/* Sections existantes */}

         {primarySuggestion && (
           <section className="meal-suggestion-widget bg-gradient-to-r from-green-50 to-blue-50 rounded-xl p-4 mb-6">
             <h2 className="text-lg font-semibold mb-3 flex items-center gap-2">
               üçΩÔ∏è Id√©e repas pour toi
             </h2>

             {currentSymptoms.length > 0 && (
               <p className="text-sm text-gray-600 mb-3">
                 {this.getContextMessage(currentSymptoms)}
               </p>
             )}

             <SuggestionCard
               meal={primarySuggestion}
               onViewDetails={(meal) => navigate(`/nutrition/meals/${meal.id}`)}
               onTrackMeal={trackMealFromDashboard}
               compact={true}
             />

             <Link
               to="/nutrition/suggestions"
               className="block text-center text-blue-600 text-sm mt-3 hover:underline"
             >
               ‚ùì Pas d'id√©e pour plus tard ? Voir toutes les suggestions ‚Üí
             </Link>
           </section>
         )}

         {/* Reste du dashboard */}
       </div>
     );
   };
   ```

---

## üß™ Tests & Validation

### Tests Unitaires (Vitest)
```javascript
describe('SuggestionEngine', () => {
  test('g√©n√®re suggestions adapt√©es aux sympt√¥mes', () => {
    const context = {
      symptoms: ['fatigue', 'cravings'],
      timeOfDay: 12, // midi
      maxPrepTime: 15
    };

    const suggestions = SuggestionEngine.generateSuggestions(context);

    expect(suggestions).toHaveLength(3);
    expect(suggestions[0].symptomTargets).toEqual(
      expect.arrayContaining(['fatigue'])
    );
    expect(suggestions[0].prepTimeMinutes).toBeLessThanOrEqual(15);
  });

  test('exclut repas r√©cents de l\'historique', () => {
    const context = {
      symptoms: ['fatigue'],
      recentMeals: [
        { meal_id: 'bowl-quinoa-avocat', created_at: new Date() }
      ]
    };

    const suggestions = SuggestionEngine.generateSuggestions(context);

    // Le bowl quinoa ne devrait pas √™tre en premi√®re position
    expect(suggestions[0].id).not.toBe('bowl-quinoa-avocat');
  });

  test('respecte les restrictions alimentaires', () => {
    const context = {
      preferences: {
        dietaryRestrictions: ['vegetarian'],
        allergies: ['nuts']
      }
    };

    const suggestions = SuggestionEngine.generateSuggestions(context);

    suggestions.forEach(meal => {
      expect(meal.ingredients.toLowerCase()).not.toContain('meat');
      expect(meal.ingredients.toLowerCase()).not.toContain('nuts');
    });
  });
});
```

### Tests d'Int√©gration
```javascript
describe('Meal Suggestions Feature E2E', () => {
  test('flow complet suggestion depuis dashboard', async () => {
    // Setup utilisateur avec sympt√¥mes
    const user = await createTestUser({ symptoms: ['fatigue'] });

    render(<DashboardView />, { user });

    // V√©rifier affichage suggestion
    await waitFor(() => {
      expect(screen.getByText(/id√©e repas pour toi/i)).toBeInTheDocument();
    });

    // V√©rifier contextualisation
    expect(screen.getByText(/tu sembles fatigu√©e/i)).toBeInTheDocument();

    // Cliquer sur suggestion
    const suggestionCard = screen.getByText(/bowl/i);
    fireEvent.click(suggestionCard);

    // V√©rifier d√©tails
    expect(screen.getByText(/ingr√©dients/i)).toBeInTheDocument();
    expect(screen.getByText(/pr√©paration/i)).toBeInTheDocument();

    // Tracker consommation
    fireEvent.click(screen.getByText(/j'ai mang√©/i));

    await waitFor(() => {
      expect(mockTrackingService.trackMealConsumption).toHaveBeenCalledWith(
        user.id,
        expect.any(String),
        'lunch'
      );
    });
  });
});
```

### Crit√®res de Validation MVP
- [ ] **Pertinence** : 85% des suggestions jug√©es appropri√©es par utilisatrices
- [ ] **Facilit√©** : 90% des recettes class√©es "facile" r√©ellement r√©alis√©es en temps annonc√©
- [ ] **Adoption** : 60% utilisatrices consultent suggestions 3+ fois/semaine
- [ ] **Tracking** : 40% utilisatrices trackent au moins 1 repas/jour
- [ ] **Performance** : G√©n√©ration suggestions < 500ms

---

## üöÄ D√©ploiement & Monitoring

### Variables d'Environnement
```env
# Configuration suggestions
VITE_MAX_SUGGESTIONS_COUNT=3
VITE_DEFAULT_PREP_TIME=30
VITE_ENABLE_MEAL_TRACKING=true

# Feature flags
VITE_ENABLE_ADVANCED_FILTERING=false
VITE_ENABLE_CALORIE_TRACKING=false
VITE_ENABLE_RECIPE_SHARING=false
```

### M√©triques Cl√©s
```javascript
// Analytics events nutrition
const trackNutritionEvents = {
  suggestion_viewed: (mealId, context) => analytics.track('Meal Suggestion Viewed', {
    meal_id: mealId,
    symptoms: context.symptoms,
    time_of_day: context.timeOfDay
  }),
  suggestion_detailed: (mealId) => analytics.track('Meal Details Viewed', { meal_id: mealId }),
  meal_tracked: (mealId, mealType, satisfaction) => analytics.track('Meal Tracked', {
    meal_id: mealId,
    meal_type: mealType,
    satisfaction_rating: satisfaction
  }),
  suggestions_refreshed: (count) => analytics.track('Suggestions Refreshed', { count }),
  suggestion_relevance: (mealId, rating) => analytics.track('Suggestion Relevance Rated', {
    meal_id: mealId,
    relevance_rating: rating
  })
};
```

### Dashboard Monitoring
- **Engagement** : Taux de consultation suggestions depuis dashboard
- **Conversion** : % suggestions ‚Üí d√©tails vus ‚Üí repas track√©s
- **Pertinence** : Note moyenne de pertinence des suggestions
- **Performance** : Temps de g√©n√©ration par utilisatrice

---

## üîÑ √âvolutions Post-MVP

### Version 1.1
- **G√©n√©ration intelligente** : Machine learning pour am√©liorer pertinence
- **Photos des plats** : Visuel pour chaque suggestion
- **Mode courses** : G√©n√©ration liste d'ingr√©dients pour plusieurs repas

### Version 1.2
- **Planification repas** : Suggestions pour toute la semaine
- **Int√©gration courses** : API supermarch√©s pour commande en ligne
- **Partage communaut√©** : Suggestions entre utilisatrices

---

## ‚úÖ Definition of Done

### Crit√®res Techniques
- [ ] Base de donn√©es repas popul√©e avec 50+ recettes valid√©es
- [ ] Algorithme suggestions test√© sur 20+ profils diff√©rents
- [ ] Performance < 300ms pour g√©n√©ration suggestions
- [ ] Code coverage > 85% pour logique m√©tier
- [ ] Int√©gration fluide dashboard sans r√©gression

### Crit√®res Utilisateur
- [ ] Tests utilisateur > 4.3/5 sur utilit√© suggestions
- [ ] Recettes test√©es par √©quipe pour faisabilit√© temps annonc√©
- [ ] Langage bienveillant valid√© par psychologue nutrition
- [ ] 0 suggestion avec ingr√©dients difficiles √† trouver
- [ ] Interface accessible malvoyants

### Crit√®res Business
- [ ] Tracking complet pour analyser patterns d'usage
- [ ] Foundation pr√™te pour mon√©tisation future (partenariats)
- [ ] Base de connaissances nutrition extensible
- [ ] M√©triques de satisfaction configur√©es

---

*üìã Cette feature transforme l'app en assistant nutrition personnalis√©, donnant confiance aux utilisatrices SOPK dans leurs choix alimentaires quotidiens.*